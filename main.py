from logging import Filter
import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
import telebot

SMTP_SERVER = 'smtp-pulse.com'
SMTP_PORT = 2525
SMTP_USERNAME = 'sparrowiptv@gmail.com'
SMTP_PASSWORD = 'S7SZS7QRf5J'
BOT_TOKEN = '5977154067:AAHF2AHqStYdNCivALZzW6HBFvPKyLEdBZ8'
SENDER_EMAIL = 'support@sparrowiptv.com'


bot = telebot.TeleBot(BOT_TOKEN)

@bot.message_handler(commands=['start', 'hello'])
def send_welcome(message):
    bot.reply_to(message, "Hi! To send renew email /renew \n/To send new subscription /new")

@bot.message_handler(commands=['renew'])
def code_handler(message):
    text = "Please enter your email address."
    sent_msg = bot.send_message(message.chat.id, text, parse_mode="Markdown")
    bot.register_next_step_handler(
        sent_msg, fetch_email, bot=bot)
    
@bot.message_handler(commands=['new'])
def code_handler(message):
    emailuser = "Please enter your email address"
    sent_msg = bot.send_message(message.chat.id, emailuser, parse_mode="Markdown")
    bot.register_next_step_handler(
        sent_msg, new_email, bot=bot)   
    
def new_email(message, bot):
    email = message.text
    bot.send_message(chat_id=message.chat.id, text="Please Enter Username")
    bot.register_next_step_handler(message, get_username, email=email, bot=bot)

def get_username(message, email, bot):
    username = message.text
    bot.send_message(chat_id=message.chat.id, text="Please Enter Password")
    bot.register_next_step_handler(message, send_email, email=email, username=username, bot=bot)

def fetch_email(message, bot):
    email = message.text
    msg = MIMEMultipart()
    msg['From'] = SENDER_EMAIL
    msg['To'] = email
    msg['Subject'] = 'SPARROW IPTV | RENEW YOUR IPTV SUBCRIPTION'
    body = '''<div style="font-family: Arial, sans-serif; font-size: 14px;"><div style="font-family: Arial, sans-serif; font-size: 14px;"><table cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;width:100%" border="0" width="100%"><tbody><tr style="border-color:transparent"><td style="border-collapse:collapse;border-color:transparent;padding-left:0;padding-right:0;padding-top:0;padding-bottom:0;vertical-align:top" border="0" cellpadding="0" cellspacing="0" valign="top"><table cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;width:100%" border="0" width="100%"><tbody><tr style="border-color:transparent"><th width="550" style="border-color:transparent;font-weight:400;text-align:left;vertical-align:top" cellpadding="0" cellspacing="0" class="m_-1258183266750818949tc m_-1258183266750818949responsive" align="left" valign="top"><table border="0" width="100%" cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;border-top-right-radius:0;border-top-left-radius:0;border-bottom-left-radius:0;border-bottom-right-radius:0"><tbody><tr style="border-color:transparent"><td cellpadding="0" cellspacing="0" style="border-collapse:collapse;border-color:transparent;vertical-align:top" valign="top"><table width="100%" cellpadding="0" cellspacing="0" id="m_-1258183266750818949wout_block_14_element_0" style="border-collapse:separate;font-size:14px;line-height:1.5;overflow:hidden"><tbody><tr style="border-color:transparent;color:#444;font-family:Arial,&quot;Helvetica Neue&quot;,Helvetica,sans-serif"><td class="m_-1258183266750818949content-cell" width="520" style="border-collapse:collapse;border-color:transparent;vertical-align:top;padding-left:15px;padding-right:15px;padding-top:15px;padding-bottom:15px" valign="top"><div id="m_-1258183266750818949wout_block_14_element_0" style="font-size:14px;line-height:1.5;width:100%;height:48;display:block;text-align:center" width="100%" height="48" align="center"><center><img border="0" width="260" height="auto" class="m_-1258183266750818949desktop m_-1258183266750818949sp-img CToWUd" align="center" alt="cropped-cropped-cropped-564eec96-c46f-4b64-a5fc-a6ac6a953438-1" style="height:auto;line-height:100%;outline:0;text-decoration:none;border:0;display:block" data-bit="iit" src="https://ci6.googleusercontent.com/proxy/JstUwYBDaw8UWBz3RgXgKPTf0PnjsimEEKthZsad7bMbllrjhAMo0D8ocQJftuM9c31hcwW0BWVa4Whb80Y6RKhUaMhMjUWcAIfmTsXLphjtzNldg6yE4_LRQ61pYhIqWy2kOcUw_WnJ3zOcNLr1YibJiBF-T01h_n_YN1LAs7CgzRWXGoGkpI2m3Mcm3Y9E7zAJ4BMJV9JpXm8lZkjxF2tCfA6DuYkq5FgwhpoaYaXZbnD-WL8p=s0-d-e1-ft#https://s8053406.sendpul.se/files/emailservice/userfiles/da7296114b94c0207615b2cb64fd3bfa8053406/cropped-cropped-cropped-564eec96-c46f-4b64-a5fc-a6ac6a953438-1.png"><div style="font-size:14px;line-height:1.5"><img border="0" width="100%" height="auto" class="m_-1258183266750818949mobile m_-1258183266750818949sp-img CToWUd" align="center" alt="cropped-cropped-cropped-564eec96-c46f-4b64-a5fc-a6ac6a953438-1" style="height:auto;line-height:100%;outline:0;text-decoration:none;border:0;display:none;width:100%;max-width:100%!important" data-bit="iit" src="https://ci6.googleusercontent.com/proxy/JstUwYBDaw8UWBz3RgXgKPTf0PnjsimEEKthZsad7bMbllrjhAMo0D8ocQJftuM9c31hcwW0BWVa4Whb80Y6RKhUaMhMjUWcAIfmTsXLphjtzNldg6yE4_LRQ61pYhIqWy2kOcUw_WnJ3zOcNLr1YibJiBF-T01h_n_YN1LAs7CgzRWXGoGkpI2m3Mcm3Y9E7zAJ4BMJV9JpXm8lZkjxF2tCfA6DuYkq5FgwhpoaYaXZbnD-WL8p=s0-d-e1-ft#https://s8053406.sendpul.se/files/emailservice/userfiles/da7296114b94c0207615b2cb64fd3bfa8053406/cropped-cropped-cropped-564eec96-c46f-4b64-a5fc-a6ac6a953438-1.png"></div></center></div><div style="font-size:14px;line-height:1.5;clear:both"></div></td></tr></tbody></table></td></tr></tbody></table></th></tr></tbody></table></td></tr></tbody></table><table cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;width:100%" border="0" width="100%"><tbody><tr style="border-color:transparent"><td style="border-collapse:collapse;border-color:transparent;padding-left:0;padding-right:0;padding-top:0;padding-bottom:0;vertical-align:top" border="0" cellpadding="0" cellspacing="0" valign="top"><table cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;width:100%" border="0" width="100%"><tbody><tr style="border-color:transparent"><th width="550" style="border-color:transparent;font-weight:400;text-align:left;vertical-align:top" cellpadding="0" cellspacing="0" class="m_-1258183266750818949tc m_-1258183266750818949responsive" align="left" valign="top"><table border="0" width="100%" cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;border-top-right-radius:0;border-top-left-radius:0;border-bottom-left-radius:0;border-bottom-right-radius:0"><tbody><tr style="border-color:transparent"><td cellpadding="0" cellspacing="0" style="border-collapse:collapse;border-color:transparent;vertical-align:top" valign="top"><table width="100%" cellpadding="0" cellspacing="0" id="m_-1258183266750818949w" style="border-collapse:separate;font-size:14px;line-height:1.5;background-color:#fff;font-weight:normal;color:#333;margin:0;overflow:hidden" bgcolor="#ffffff"><tbody><tr style="border-color:transparent;color:#444;font-family:Arial,&quot;Helvetica Neue&quot;,Helvetica,sans-serif"><td class="m_-1258183266750818949content-cell" width="490" style="border-collapse:collapse;border-color:transparent;vertical-align:top;padding-left:30px;padding-right:30px;padding-top:25px;padding-bottom:20px" valign="top"><h3 style="line-height:1.2;margin:0 0 10px;font-weight:normal;font-size:24px;color:#333;font-family:Arial,&quot;Helvetica Neue&quot;,Helvetica,sans-serif"><strong>Greetings!</strong></h3><p style="line-height:inherit;margin:0 0 10px;font-size:inherit;color:#333;font-family:Arial,&quot;Helvetica Neue&quot;,Helvetica,sans-serif;font-weight:normal;padding:0"><span style="font-weight:400">We're from Sparrow IPTV!</span></p><div style="line-height: 1.5;">This is a reminder email that your subscription is going to expire. Why you need to struggle for entertainment&nbsp;renew your subscription before it expires and resume your service and keep enjoying.</div><div style="font-size:14px;line-height:1.5;clear:both"></div></td></tr></tbody></table></td></tr></tbody></table></th></tr></tbody></table></td></tr></tbody></table><table cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;width:100%" border="0" width="100%"><tbody><tr style="border-color:transparent"><td style="border-collapse:collapse;border-color:transparent;padding-left:0;padding-right:0;padding-top:0;padding-bottom:0;vertical-align:top" border="0" cellpadding="0" cellspacing="0" valign="top"><table cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;width:100%" border="0" width="100%"><tbody><tr style="border-color:transparent"><th width="550" style="border-color:transparent;font-weight:400;text-align:left;vertical-align:top" cellpadding="0" cellspacing="0" class="m_-1258183266750818949tc m_-1258183266750818949responsive" align="left" valign="top"><table border="0" width="100%" cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;border-top-right-radius:0;border-top-left-radius:0;border-bottom-left-radius:0;border-bottom-right-radius:0"><tbody><tr style="border-color:transparent"><td cellpadding="0" cellspacing="0" style="border-collapse:collapse;border-color:transparent;vertical-align:top" valign="top"><table width="100%" cellpadding="0" cellspacing="0" style="border-collapse:separate;font-size:14px;line-height:1.5;background-color:#fff;overflow:hidden" bgcolor="#ffffff"><tbody><tr style="border-color:transparent;color:#444;font-family:Arial,&quot;Helvetica Neue&quot;,Helvetica,sans-serif"><td class="m_-1258183266750818949content-cell" width="570" style="border-collapse:collapse;border-color:transparent;vertical-align:top;padding-left:15px;padding-right:15px;padding-top:5px;padding-bottom:5px" valign="top"><center><table cellpadding="0" border="0" cellspacing="0" class="m_-1258183266750818949sp-button" style="border-collapse:collapse;font-size:14px;line-height:1.5;border:0;margin-left:auto;margin-right:auto;width:auto!important;border-radius:10px;background-color:#888;background:linear-gradient(180deg,#888 0%,#888 84%,#696969 100%)" width="auto !important" bgcolor="#888888"><tbody><tr style="border-color:transparent"><td class="m_-1258183266750818949sp-button-text" style="border-collapse:collapse;border-color:transparent;border-width:0;border-style:none;border:0;padding:0;border-radius:10px;width:auto;height:39px;vertical-align:middle;text-align:center" width="auto" height="39" valign="middle" align="center"><table cellpadding="0" border="0" cellspacing="0" width="100%" style="border-collapse:collapse;font-size:14px;line-height:1.5;border:0"><tbody><tr style="border-color:transparent"><td align="center" style="border-collapse:collapse;border-color:transparent;border:0;padding:0;line-height:1"><a rel="noreferrer nofollow noopener" style="text-decoration:none;color:#fff;display:block;padding:11.5px 17.25px;font-family:Arial,&quot;Helvetica Neue&quot;,Helvetica,sans-serif;font-size:16px;font-weight:bold" href="https://sparrowiptv.com/">Renew Now</a></td></tr></tbody></table></td></tr></tbody></table></center><div style="font-size:14px;line-height:1.5;clear:both"></div></td></tr></tbody></table></td></tr></tbody></table></th></tr></tbody></table></td></tr></tbody></table><table cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;width:100%" border="0" width="100%"><tbody><tr style="border-color:transparent"><td style="border-collapse:collapse;border-color:transparent;padding-left:0;padding-right:0;padding-top:0;padding-bottom:0;vertical-align:top" border="0" cellpadding="0" cellspacing="0" valign="top"><table cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;width:100%" border="0" width="100%"><tbody><tr style="border-color:transparent"><th width="550" style="border-color:transparent;font-weight:400;text-align:left;vertical-align:top" cellpadding="0" cellspacing="0" class="m_-1258183266750818949tc m_-1258183266750818949responsive" align="left" valign="top"><table border="0" width="100%" cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;border-top-right-radius:0;border-top-left-radius:0;border-bottom-left-radius:0;border-bottom-right-radius:0"><tbody><tr style="border-color:transparent"><td cellpadding="0" cellspacing="0" style="border-collapse:collapse;border-color:transparent;vertical-align:top" valign="top"><table width="100%" cellpadding="0" cellspacing="0" id="m_-1258183266750818949wout_block_out_block_17" style="border-collapse:separate;font-size:14px;line-height:1.5;font-weight:normal;margin:0;overflow:hidden"><tbody><tr style="border-color:transparent;color:#444;font-family:Arial,&quot;Helvetica Neue&quot;,Helvetica,sans-serif"><td class="m_-1258183266750818949content-cell" width="520" style="border-collapse:collapse;border-color:transparent;vertical-align:top;padding-left:15px;padding-right:15px;padding-top:15px;padding-bottom:15px" valign="top"><div style="font-size:14px;line-height:1.5"><span>&nbsp; You can also contact us directly through Telegram: <a rel="noreferrer nofollow noopener" href="https://t.me/sparrowiptvsupport" style="text-decoration:none;color:#0082a3" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://t.me/sparrowiptvsupport&amp;source=gmail&amp;ust=1680640667882000&amp;usg=AOvVaw1thuyVI2jHF2byJ25WwlFt">https://t.me/<wbr>sparrowiptvsupport</a><br>&nbsp; Feel free to contact us anytime from our website via live chat.<br></span></div><div style="font-size:14px;line-height:1.5"></div><div style="font-size:14px;line-height:1.5"><span><br>&nbsp; Regards,</span></div><p style="line-height:inherit;margin:0 0 10px;font-size:inherit;color:inherit;font-family:Arial,&quot;Helvetica Neue&quot;,Helvetica,sans-serif;font-weight:normal;padding:0"><span>&nbsp; Sparrow IPTV</span></p><div style="font-size:14px;line-height:1.5;clear:both"></div></td></tr></tbody></table></td></tr></tbody></table></th></tr></tbody></table></td></tr></tbody></table><table cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;width:100%" border="0" width="100%"><tbody><tr style="border-color:transparent"><td style="border-collapse:collapse;border-color:transparent;padding-left:0;padding-right:0;padding-top:0;padding-bottom:0;vertical-align:top" border="0" cellpadding="0" cellspacing="0" valign="top"><table cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;width:100%" border="0" width="100%"><tbody><tr style="border-color:transparent"><th width="550" style="border-color:transparent;font-weight:400;text-align:left;vertical-align:top" cellpadding="0" cellspacing="0" class="m_-1258183266750818949tc m_-1258183266750818949responsive" align="left" valign="top"><table border="0" width="100%" cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;border-top-right-radius:0;border-top-left-radius:0;border-bottom-left-radius:0;border-bottom-right-radius:0"><tbody><tr style="border-color:transparent"><td cellpadding="0" cellspacing="0" style="border-collapse:collapse;border-color:transparent;vertical-align:top" valign="top"><table width="100%" cellpadding="0" cellspacing="0" style="border-collapse:separate;font-size:14px;line-height:1.5;background-color:#eee;padding-left:0;padding-right:0;padding-top:0;padding-bottom:0;height:19px" bgcolor="#eeeeee" height="19"><tbody><tr style="border-color:transparent"><td height="19" style="border-collapse:collapse;border-color:transparent"></td></tr></tbody></table></td></tr></tbody></table></th></tr></tbody></table></td></tr></tbody></table><table cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;width:100%" border="0" width="100%"><tbody><tr style="border-color:transparent"><td style="border-collapse:collapse;border-color:transparent;padding-left:0;padding-right:0;padding-top:0;padding-bottom:0;vertical-align:top" border="0" cellpadding="0" cellspacing="0" valign="top"><table cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;width:100%" border="0" width="100%"><tbody><tr style="border-color:transparent"><th width="550" style="border-color:transparent;font-weight:400;text-align:left;vertical-align:top" cellpadding="0" cellspacing="0" class="m_-1258183266750818949tc m_-1258183266750818949responsive" align="left" valign="top"><table border="0" width="100%" cellpadding="0" cellspacing="0" style="border-collapse:collapse;font-size:14px;line-height:1.5;border-top-right-radius:0;border-top-left-radius:0;border-bottom-left-radius:0;border-bottom-right-radius:0"><tbody><tr style="border-color:transparent"><td cellpadding="0" cellspacing="0" style="border-collapse:collapse;border-color:transparent;vertical-align:top" valign="top"><table width="100%" cellpadding="0" cellspacing="0" id="m_-1258183266750818949w" style="border-collapse:separate;font-size:14px;line-height:1.5;background-color:#eee;font-weight:normal;margin:0;overflow:hidden" bgcolor="#eeeeee"><tbody><tr style="border-color:transparent;color:#444;font-family:Arial,&quot;Helvetica Neue&quot;,Helvetica,sans-serif"><td class="m_-1258183266750818949content-cell" width="490" style="border-collapse:collapse;border-color:transparent;vertical-align:top;padding-left:30px;padding-right:30px;padding-top:20px;padding-bottom:10px" valign="top"><p style="line-height:inherit;margin:0 0 10px;font-size:inherit;color:inherit;font-family:Arial,&quot;Helvetica Neue&quot;,Helvetica,sans-serif;text-align:center;font-weight:normal;padding:0" align="center"><span style="font-size:13px">You have received this email because you are a client or subscriber. <span style="text-decoration:underline"><a rel="noreferrer nofollow noopener" href="#" style="text-decoration:none;color:#0082a3" target="_blank" data-saferedirecturl="#">Unsubscribe</a></span>.</span></p><div style="font-size:14px;line-height:1.5;clear:both"></div></td></tr></tbody></table></td></tr></tbody></table></th></tr></tbody></table></td></tr></tbody></table></div><div class="protonmail_signature_block" style="font-family: Arial, sans-serif; font-size: 14px;">
</div></div><div style="font-family: Arial, sans-serif; font-size: 14px;" class="protonmail_signature_block">
</div>'''
    msg.attach(MIMEText(body, 'html'))
    try:
        smtp_server = smtplib.SMTP(SMTP_SERVER, SMTP_PORT)
        smtp_server.starttls()
        smtp_server.login(SMTP_USERNAME, SMTP_PASSWORD)
        text = msg.as_string()
        smtp_server.sendmail(SENDER_EMAIL, email, text)
        smtp_server.quit()
        bot.send_message(chat_id=message.chat.id, text=f"Email sent to {email}")
    except Exception as e:
        bot.send_message(chat_id=message.chat.id, text=f"Failed to send email. Error: {e}")

def send_email(message, email, username, bot):
    password = message.text
    msg = MIMEMultipart()
    msg['From'] = SENDER_EMAIL
    msg['To'] = email
    msg['Subject'] = 'SPARROW IPTV | IPTV STREAMING SUBSCRIPTION ORDER'
    body = f'''<div style="font-family: Arial, sans-serif; font-size: 14px;"></div><div style="line-height:1.5"><p style="font-size:16px;margin:1em 0px;font-family:Roboto, sans-serif;text-align:left;background-color:rgb(255, 255, 255);color:rgb(98, 98, 98)"><span style="line-height:normal;font-size:12pt;color:rgb(34, 34, 34)">Hello there,</span></p><p style="font-size:16px;margin:1em 0px;font-family:Roboto, sans-serif;text-align:left;background-color:rgb(255, 255, 255);color:rgb(98, 98, 98)"><span style="font-size:small"></span></p><span style="line-height:normal;font-size:10.5pt">Please read and save this email for your record.</span><div><br></div><div><span><b><u>1. Save Your Login Details</u></b></span></div><div><br></div><div><span>Username: {username}\n\nPassword: {password}</span></span></span></div><div><br></div><div><span><b><u>2. Download Android or Firestick App</u></b></span></div><div><span><b><u>For Android &amp; Firestick:</u></b></span></div><div><br></div><div><span>App (New Interface):&nbsp;<span><a href="https://aftv.news/943734" rel="noreferrer nofollow noopener" target="_blank" style="text-decoration:underline;cursor:pointer">https://aftv.news/943734</a></span></span></div><div><br></div><b>If you don't know how to install app in firestick. Follow This Tutorial:<span>&nbsp;</span></b><a title="How to Install APP on Firestick" href="https://extz.net/how-to-install-iptv-apk-app-on-firestick/" rel="noreferrer nofollow noopener" target="_blank" style="text-decoration:underline;cursor:pointer">How to Install APP on Firestick</a><br><br><b><u>IPTV Smarters Player Server URL:</u></b></div><div style="line-height:1.5"><a href="http://mag.sparrowiptv.com" title="http://mag.sparrowiptv.com">http://mag.sparrowiptv.com<br></a><table style="margin-bottom:0px;table-layout:auto;font-size:16px;color:rgb(10, 10, 10);font-family:Roboto, sans-serif;text-align:left;background-color:rgb(255, 255, 255);border-collapse:collapse;width:480px"><tbody><tr><td style="font-size:1em;margin:0px;width:476px"><span style="color:rgb(98, 98, 98);font-family:Helvetica, sans-serif;font-weight:bold;background-color:rgb(255, 255, 255)"><span></span></span></td></tr></tbody></table><span><br><b><u>For iPhone, iPad, Apple TV:<br></u></b></span><span>Please download Purple Player from Appstore and Login with Code : A306FB then Select Premium from the list and enter your credentials as normal.</span><table style="margin-bottom:0px;table-layout:auto;font-size:16px;color:rgb(10, 10, 10);font-family:Roboto, sans-serif;text-align:left;background-color:rgb(255, 255, 255);border-collapse:collapse;width:480px"><tbody><tr><td style="font-size:1em;margin:0px;width:476px"></td></tr></tbody></table><br><hr style="font-size:16px;font-family:Roboto, sans-serif;text-align:left;background-color:rgb(255, 255, 255);color:rgb(98, 98, 98)"><p style="font-size:16px;margin:1em 0px;font-family:Roboto, sans-serif;text-align:left;background-color:rgb(255, 255, 255);color:rgb(98, 98, 98)"><span style="font-family:Arial, sans-serif;color:rgb(0, 0, 0);font-size:0.875rem">If you need assistance with some other device or anything you are confused about, Please feel free to reply to this email.</span></p><div><span>Cheers,</span></div><span><span>Sparrow IPTV</span></span></div><div class="protonmail_signature_block" style="font-family: Arial, sans-serif; font-size: 14px;"><div class="protonmail_signature_block-proton"></div></div>'''
    msg.attach(MIMEText(body, 'html'))
    try:
        smtp_server = smtplib.SMTP(SMTP_SERVER, SMTP_PORT)
        smtp_server.starttls()
        smtp_server.login(SMTP_USERNAME, SMTP_PASSWORD)
        text = msg.as_string()
        smtp_server.sendmail(SENDER_EMAIL, email, text)
        smtp_server.quit()
        bot.send_message(chat_id=message.chat.id, text=f"Email sent to {email}")
    except Exception as e:
        bot.send_message(chat_id=message.chat.id, text=f"Failed to send email. Error: {e}")

bot.infinity_polling()
